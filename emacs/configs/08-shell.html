<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shell Integration</title>
<meta name="generator" content="Org Mode" />
<meta name="viewport" content="width=device-width, initial-scale=1"><script src="https://cdn.tailwindcss.com?plugins=typography"></script><script>window.tailwind = window.tailwind || {};window.tailwind.config = { darkMode: 'media' }; /* follow browser */</script>
<style>
  :root { color-scheme: light dark; }      /* hint to UA widgets, form controls */
  body { margin:0; }
  @media (prefers-color-scheme: light) { body { background: #ffffff; } }
  @media (prefers-color-scheme: dark)  { body { background: #0b0b0b; } }
</style><link rel="stylesheet" href="/assets/styles/toc-sidebar.css"><script src="/assets/scripts/toc-sidebar.js" defer></script>
</head>
<body>
<main id="content" class="prose prose-zinc dark:prose-invert mx-auto w-full max-w-xl md:max-w-xl lg:max-w-2xl xl:max-w-3xl px-4 sm:px-6 lg:px-8">
<h1 class="title">Shell Integration</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org13b6827">1. Introduction</a></li>
<li><a href="#org2dc4aec">2. Terminal Emulators</a>
<ul>
<li><a href="#org24df53d">2.1. Eat (Emulate A Terminal)</a></li>
<li><a href="#org43612eb">2.2. Vterm (Terminal Emulator)</a></li>
</ul>
</li>
<li><a href="#orgacfa7a9">3. Shell Mode</a></li>
<li><a href="#org5a06128">4. Eshell</a>
<ul>
<li><a href="#org587002b">4.1. Core Configuration</a></li>
<li><a href="#org3062882">4.2. Eshell Prompt</a></li>
<li><a href="#orgfd0bb72">4.3. Eshell Aliases</a></li>
<li><a href="#orgfdcf550">4.4. Eshell Banner</a></li>
</ul>
</li>
<li><a href="#org8df98e5">5. Custom Shell Utilities</a>
<ul>
<li><a href="#orgb78344b">5.1. Async Shell Command</a></li>
<li><a href="#org87646e7">5.2. Quick Shell Command in Project</a></li>
<li><a href="#org96f81fd">5.3. Open External Terminal</a></li>
<li><a href="#org5071e7c">5.4. DWIM Shell Command</a></li>
</ul>
</li>
<li><a href="#org10e0281">6. Agent Shell</a>
<ul>
<li><a href="#org0f2cd87">6.1. Agent Shell Core</a></li>
<li><a href="#org0cd8ae9">6.2. Agent Shell Manager</a></li>
<li><a href="#orge8764ee">6.3. Agent Shell Sidebar</a></li>
</ul>
</li>
<li><a href="#org6b1a5dd">7. End of File</a></li>
</ul>
</div>
</div>

<div id="outline-container-org13b6827" class="outline-2">
<h2 id="org13b6827"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
Comprehensive terminal and shell integration for Emacs, providing multiple options for command-line interaction:
</p>

<ul class="org-ul">
<li><b><b>Terminal Emulators</b></b>: eat and vterm for full terminal emulation</li>
<li><b><b>Shell Mode</b></b>: Traditional comint-based shell with readline support</li>
<li><b><b>Eshell</b></b>: Pure Elisp shell with deep Emacs integration</li>
<li><b><b>Custom Utilities</b></b>: Enhanced async shell commands with project awareness</li>
</ul>
</div>
</div>

<div id="outline-container-org2dc4aec" class="outline-2">
<h2 id="org2dc4aec"><span class="section-number-2">2.</span> Terminal Emulators</h2>
<div class="outline-text-2" id="text-2">
<p>
Full-featured terminal emulators that support complex TUI applications like <code>vim</code>, <code>htop</code>, <code>ncurses</code> programs, etc.
</p>
</div>

<div id="outline-container-org24df53d" class="outline-3">
<h3 id="org24df53d"><span class="section-number-3">2.1.</span> Eat (Emulate A Terminal)</h3>
<div class="outline-text-3" id="text-2-1">
<p>
A fast, feature-complete terminal emulator written in pure Elisp. Works great on all platforms and integrates seamlessly with eshell.
</p>

<p>
Features:
</p>
<ul class="org-ul">
<li>Pure Elisp implementation (no external dependencies)</li>
<li>Full 256-color support</li>
<li>Mouse support</li>
<li>Integration with eshell for visual commands</li>
<li>Fast and lightweight</li>
<li>Kill buffer on exit for cleaner workflow</li>
</ul>

<p>
Usage:
</p>
<ul class="org-ul">
<li><code>C-c `</code> : Open eat terminal</li>
<li><code>C-c t e</code> : Alternative binding</li>
<li>Works automatically in eshell for visual commands</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">shell-conf.el --- Shell and Terminal Configuration  -*- lexical-binding: t; -*-
</span><span class="org-comment-delimiter">;;; </span><span class="org-comment">Commentary:
</span><span class="org-comment-delimiter">;;; </span><span class="org-comment">Comprehensive configuration for terminal emulators, shell modes,
</span><span class="org-comment-delimiter">;;; </span><span class="org-comment">and Emacs shell (eshell) with custom utilities.
</span><span class="org-comment-delimiter">;;; </span><span class="org-comment">Code:
</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Terminal Emulators
</span>(<span class="org-keyword">use-package</span> eat
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Use eat-256color for best compatibility with interactive programs
</span>  (eat-term-name <span class="org-string">"eat-256color"</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable yanking to terminal
</span>  (eat-enable-yank-to-terminal t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Clean up buffers when terminal exits
</span>  (eat-kill-buffer-on-exit t)
  <span class="org-builtin">:bind</span>
  ((<span class="org-string">"C-c `"</span> . eat)         <span class="org-comment-delimiter">; </span><span class="org-comment">Open eat terminal
</span>   (<span class="org-string">"C-c t e"</span> . eat))      <span class="org-comment-delimiter">; </span><span class="org-comment">Alternative binding
</span>  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">CRITICAL: Compile terminfo database for eat
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">This is required for proper terminal emulation
</span>  (<span class="org-keyword">unless</span> (file-exists-p (expand-file-name <span class="org-string">"~/.terminfo/e/eat-256color"</span>))
    (eat-compile-terminfo))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable eat in eshell for better terminal emulation
</span>  (add-hook 'eshell-load-hook #'eat-eshell-mode)
  (add-hook 'eshell-load-hook #'eat-eshell-visual-command-mode)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Performance optimizations
</span>  (add-hook 'eat-mode-hook
            (<span class="org-keyword">lambda</span> ()
              <span class="org-comment-delimiter">;; </span><span class="org-comment">Disable line numbers in terminal
</span>              (<span class="org-keyword">setq-local</span> display-line-numbers nil)
              <span class="org-comment-delimiter">;; </span><span class="org-comment">Disable word wrap
</span>              (<span class="org-keyword">setq-local</span> truncate-lines t))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org43612eb" class="outline-3">
<h3 id="org43612eb"><span class="section-number-3">2.2.</span> Vterm (Terminal Emulator)</h3>
<div class="outline-text-3" id="text-2-2">
<p>
High-performance terminal emulator using libvterm. Requires compilation but provides the best terminal emulation.
</p>

<p>
Features:
</p>
<ul class="org-ul">
<li>Native libvterm integration (C library)</li>
<li>Excellent performance</li>
<li>Full terminal emulation (better than eat for some edge cases)</li>
<li>Proper 256-color and true-color support</li>
<li>Good for running complex TUI applications</li>
</ul>

<p>
Note: Requires <code>cmake</code> and <code>libtool</code> for compilation. Only enabled if cmake is available.
</p>

<p>
Usage:
</p>
<ul class="org-ul">
<li><code>C-c t v</code> : Open vterm</li>
<li><code>C-c t n</code> : Open vterm in other window</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Vterm - only if cmake is available for compilation
</span>(<span class="org-keyword">when</span> (executable-find <span class="org-string">"cmake"</span>)
  (<span class="org-keyword">use-package</span> vterm
    <span class="org-builtin">:ensure</span> t
    <span class="org-builtin">:custom</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Scrollback buffer size (larger = more history)
</span>    (vterm-max-scrollback 10000)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Buffer naming
</span>    (vterm-buffer-name-string <span class="org-string">"vterm %s"</span>)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Clean up on exit
</span>    (vterm-kill-buffer-on-exit t)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Redisplay optimization
</span>    (vterm-timer-delay nil)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Always try to compile the module
</span>    (vterm-always-compile-module t)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Set proper TERM environment
</span>    (vterm-environment '(<span class="org-string">"TERM=xterm-256color"</span>))
    (vterm-term-environment-variable <span class="org-string">"xterm-256color"</span>)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Shell to use (defaults to $SHELL or /bin/bash)
</span>    (vterm-shell (<span class="org-keyword">or</span> (getenv <span class="org-string">"SHELL"</span>) <span class="org-string">"/bin/bash"</span>))
    <span class="org-builtin">:bind</span>
    ((<span class="org-string">"C-c t v"</span> . vterm)
     (<span class="org-string">"C-c t n"</span> . vterm-other-window))
    <span class="org-builtin">:config</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't query when killing vterm buffer
</span>    (add-hook 'vterm-mode-hook
              (<span class="org-keyword">lambda</span> ()
                (<span class="org-keyword">setq-local</span> confirm-kill-processes nil)
                (<span class="org-keyword">setq-local</span> display-line-numbers nil)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgacfa7a9" class="outline-2">
<h2 id="orgacfa7a9"><span class="section-number-2">3.</span> Shell Mode</h2>
<div class="outline-text-2" id="text-3">
<p>
Traditional comint-based shell mode that runs your system shell (bash, zsh, etc.) in an Emacs buffer.
</p>

<p>
Features:
</p>
<ul class="org-ul">
<li>Uses your default system shell</li>
<li>Full readline support</li>
<li>History navigation with <code>M-p</code> / <code>M-n</code></li>
<li>Command completion with <code>TAB</code></li>
<li>Read-only prompt to prevent accidental edits</li>
<li>Echo process output for better display</li>
</ul>

<p>
When to use:
</p>
<ul class="org-ul">
<li>Quick shell commands that don't need full terminal emulation</li>
<li>When you want Emacs-style editing of command lines</li>
<li>Simple tasks that benefit from Emacs integration</li>
</ul>

<p>
Usage:
</p>
<ul class="org-ul">
<li><code>M-x shell</code> : Open shell buffer</li>
<li><code>C-x p s</code> : Open shell in project root (via project.el)</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Shell Mode
</span>(<span class="org-keyword">use-package</span> shell
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Make prompt read-only to prevent accidental edits
</span>  (comint-prompt-read-only t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Process should echo output (prevents duplication)
</span>  (comint-process-echoes t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Scrollback buffer size
</span>  (comint-buffer-maximum-size 10000)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Always scroll to bottom on input
</span>  (comint-scroll-to-bottom-on-input t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Move point to end before sending input
</span>  (comint-move-point-for-output t)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable ANSI colors in shell output
</span>  (add-hook 'shell-mode-hook #'ansi-color-for-comint-mode-on)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Make shell buffers more distinctive
</span>  (add-hook 'shell-mode-hook
            (<span class="org-keyword">lambda</span> ()
              (<span class="org-keyword">setq-local</span> scroll-margin 0))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a06128" class="outline-2">
<h2 id="org5a06128"><span class="section-number-2">4.</span> Eshell</h2>
<div class="outline-text-2" id="text-4">
<p>
Emacs Shell (eshell) is a pure Elisp command shell that provides deep integration with Emacs. Unlike shell-mode, eshell doesn't run a separate shell process but implements shell features directly in Elisp.
</p>
</div>

<div id="outline-container-org587002b" class="outline-3">
<h3 id="org587002b"><span class="section-number-3">4.1.</span> Core Configuration</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Features:
</p>
<ul class="org-ul">
<li>Pure Elisp implementation (no subprocess)</li>
<li>Cross-platform consistency</li>
<li>Mix shell commands with Elisp functions</li>
<li>Powerful scripting with Elisp</li>
<li>Visual command support for TUI apps</li>
<li>Smart history with deduplication</li>
</ul>

<p>
When to use:
</p>
<ul class="org-ul">
<li>Cross-platform scripts (same behavior on Windows/Linux/macOS)</li>
<li>Mix shell and Elisp commands seamlessly</li>
<li>When you want deep Emacs integration</li>
<li>Scripting that needs Elisp functions</li>
</ul>

<p>
Usage:
</p>
<ul class="org-ul">
<li><code>M-x eshell</code> : Open eshell buffer</li>
<li><code>C-x p e</code> : Open eshell in project root (via project.el)</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Eshell
</span>(<span class="org-keyword">use-package</span> eshell
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">History settings
</span>  (eshell-history-size 10000)
  (eshell-buffer-maximum-lines 10000)
  (eshell-hist-ignoredups t)
  (eshell-save-history-on-exit t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Scrolling behavior
</span>  (eshell-scroll-to-bottom-on-input 'all)
  (eshell-scroll-to-bottom-on-output t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Command behavior
</span>  (eshell-error-if-no-glob t)
  (eshell-prefer-lisp-functions t)
  (eshell-destroy-buffer-when-process-dies t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Visual commands (use terminal emulation for these)
</span>  (eshell-visual-commands
   '(<span class="org-string">"vi"</span> <span class="org-string">"vim"</span> <span class="org-string">"nvim"</span> <span class="org-string">"screen"</span> <span class="org-string">"tmux"</span> <span class="org-string">"top"</span> <span class="org-string">"htop"</span> <span class="org-string">"btm"</span>
     <span class="org-string">"less"</span> <span class="org-string">"more"</span> <span class="org-string">"lynx"</span> <span class="org-string">"ncftp"</span> <span class="org-string">"mutt"</span> <span class="org-string">"pine"</span> <span class="org-string">"tin"</span> <span class="org-string">"trn"</span> <span class="org-string">"elm"</span>
     <span class="org-string">"irssi"</span> <span class="org-string">"nmtui"</span> <span class="org-string">"nmtui-connect"</span> <span class="org-string">"nethack"</span> <span class="org-string">"alsamixer"</span>
     <span class="org-string">"w3m"</span> <span class="org-string">"ncmpcpp"</span> <span class="org-string">"newsbeuter"</span> <span class="org-string">"fzf"</span> <span class="org-string">"ssh"</span> <span class="org-string">"tail"</span>))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Subcommands that should use visual mode
</span>  (eshell-visual-subcommands
   '((<span class="org-string">"git"</span> <span class="org-string">"log"</span> <span class="org-string">"diff"</span> <span class="org-string">"show"</span>)
     (<span class="org-string">"docker"</span> <span class="org-string">"logs"</span>)
     (<span class="org-string">"kubectl"</span> <span class="org-string">"logs"</span>)))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Options for visual commands
</span>  (eshell-visual-options
   '((<span class="org-string">"git"</span> <span class="org-string">"--paginate"</span> <span class="org-string">"--help"</span>)))

  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Load common Eshell modules
</span>  (<span class="org-keyword">require</span> '<span class="org-constant">eshell</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">em-smart</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">em-tramp</span>)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Smart display behavior
</span>  (add-hook 'eshell-mode-hook
            (<span class="org-keyword">lambda</span> ()
              <span class="org-comment-delimiter">;; </span><span class="org-comment">Plan text mode for better performance
</span>              (<span class="org-keyword">setq-local</span> global-hl-line-mode nil)
              <span class="org-comment-delimiter">;; </span><span class="org-comment">Disable line numbers
</span>              (<span class="org-keyword">setq-local</span> display-line-numbers nil))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3062882" class="outline-3">
<h3 id="org3062882"><span class="section-number-3">4.2.</span> Eshell Prompt</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Beautiful and functional prompt with git integration and directory shortening.
</p>

<p>
Features:
</p>
<ul class="org-ul">
<li>Lambda-style prompt</li>
<li>Git branch and status integration</li>
<li>Syntax highlighting</li>
<li>Clean and minimal design</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Eshell Prompt Extras
</span>(<span class="org-keyword">use-package</span> eshell-prompt-extras
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> eshell
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable prompt highlighting
</span>  (eshell-highlight-prompt t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Use lambda theme for clean look
</span>  (eshell-prompt-function 'epe-theme-lambda)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Custom prompt regexp for eshell-prompt-extras
</span>  (<span class="org-keyword">setq</span> eshell-prompt-regexp <span class="org-string">"^[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">#$\n]* [#$] "</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd0bb72" class="outline-3">
<h3 id="orgfd0bb72"><span class="section-number-3">4.3.</span> Eshell Aliases</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Convenient aliases for common commands to improve productivity.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Eshell Aliases
</span>(<span class="org-keyword">with-eval-after-load</span> 'eshell
  (<span class="org-keyword">defun</span> <span class="org-function-name">fu/eshell-setup-aliases</span> ()
    <span class="org-doc">"Set up common eshell aliases."</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Navigation
</span>    (eshell/alias <span class="org-string">".."</span> <span class="org-string">"cd .."</span>)
    (eshell/alias <span class="org-string">"..."</span> <span class="org-string">"cd ../.."</span>)
    (eshell/alias <span class="org-string">"...."</span> <span class="org-string">"cd ../../.."</span>)

    <span class="org-comment-delimiter">;; </span><span class="org-comment">List files
</span>    (eshell/alias <span class="org-string">"l"</span> <span class="org-string">"ls -lh $*"</span>)
    (eshell/alias <span class="org-string">"ll"</span> <span class="org-string">"ls -lh $*"</span>)
    (eshell/alias <span class="org-string">"la"</span> <span class="org-string">"ls -alh $*"</span>)
    (eshell/alias <span class="org-string">"lt"</span> <span class="org-string">"ls -lht $*"</span>)  <span class="org-comment-delimiter">; </span><span class="org-comment">by time
</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Git shortcuts
</span>    (eshell/alias <span class="org-string">"gs"</span> <span class="org-string">"git status"</span>)
    (eshell/alias <span class="org-string">"gd"</span> <span class="org-string">"git diff $*"</span>)
    (eshell/alias <span class="org-string">"gl"</span> <span class="org-string">"git log --oneline --graph --decorate $*"</span>)
    (eshell/alias <span class="org-string">"gp"</span> <span class="org-string">"git pull"</span>)
    (eshell/alias <span class="org-string">"gP"</span> <span class="org-string">"git push"</span>)
    (eshell/alias <span class="org-string">"ga"</span> <span class="org-string">"git add $*"</span>)
    (eshell/alias <span class="org-string">"gc"</span> <span class="org-string">"git commit $*"</span>)
    (eshell/alias <span class="org-string">"gco"</span> <span class="org-string">"git checkout $*"</span>)
    (eshell/alias <span class="org-string">"gb"</span> <span class="org-string">"git branch $*"</span>)

    <span class="org-comment-delimiter">;; </span><span class="org-comment">Emacs shortcuts
</span>    (eshell/alias <span class="org-string">"e"</span> <span class="org-string">"find-file $1"</span>)
    (eshell/alias <span class="org-string">"ee"</span> <span class="org-string">"find-file-other-window $1"</span>)
    (eshell/alias <span class="org-string">"d"</span> <span class="org-string">"dired $1"</span>)

    <span class="org-comment-delimiter">;; </span><span class="org-comment">Clear screen
</span>    (eshell/alias <span class="org-string">"clear"</span> <span class="org-string">"clear-scrollback"</span>))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Set up aliases on first eshell invocation
</span>  (add-hook 'eshell-first-time-mode-hook #'fu/eshell-setup-aliases))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfdcf550" class="outline-3">
<h3 id="orgfdcf550"><span class="section-number-3">4.4.</span> Eshell Banner</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Customize the eshell banner to be more informative and welcoming.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">  <span class="org-comment-delimiter">;; </span><span class="org-comment">Custom Eshell Banner
</span>  (<span class="org-keyword">with-eval-after-load</span> 'eshell
    (<span class="org-keyword">setq</span> eshell-banner-message
          (format <span class="org-string">"%s
Welcome to Eshell - the Emacs Shell
Type '</span><span class="org-string"><span class="org-constant">help</span></span><span class="org-string">' for common commands, or any Elisp expression to evaluate

Current directory: %s
"</span>
                  (propertize <span class="org-string">"&#9581;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9582;\n&#9474;                                          &#9474;\n&#9474;    Eshell - Emacs Shell Environment      &#9474;\n&#9474;                                          &#9474;\n&#9584;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9583;"</span>
                              'face '(<span class="org-builtin">:foreground</span> <span class="org-string">"cyan"</span>))
                  (abbreviate-file-name default-directory))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8df98e5" class="outline-2">
<h2 id="org8df98e5"><span class="section-number-2">5.</span> Custom Shell Utilities</h2>
<div class="outline-text-2" id="text-5">
<p>
Enhanced utilities for running shell commands with better integration.
</p>
</div>

<div id="outline-container-orgb78344b" class="outline-3">
<h3 id="orgb78344b"><span class="section-number-3">5.1.</span> Async Shell Command</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Improved async shell command that runs commands in project root and provides better output formatting.
</p>

<p>
Features:
</p>
<ul class="org-ul">
<li>Automatically runs in project root if in a project</li>
<li>Timestamped output buffers</li>
<li>Process completion notifications</li>
<li>Exit code reporting</li>
<li>Separate error buffers</li>
</ul>

<p>
Usage:
</p>
<ul class="org-ul">
<li><code>M-x fu/async-shell-command</code> : Run async command with enhanced output</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">  <span class="org-comment-delimiter">;; </span><span class="org-comment">Custom Shell Utilities
</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">fu/async-shell-command</span> (command)
    <span class="org-doc">"Run `</span><span class="org-doc"><span class="org-constant">async-shell-command</span></span><span class="org-doc">' with COMMAND in project root.
Provides better output formatting and runs in project context."</span>
    (<span class="org-keyword">interactive</span> (list (read-string <span class="org-string">"Shell command: "</span>)))
    (<span class="org-keyword">let*</span> ((output-buffer-time (format-time-string <span class="org-string">"%Y-%m-%dT%H:%M:%S"</span>))
           (output-buffer-name (format <span class="org-string">"*Shell Command [%s]: %s*"</span> output-buffer-time command))
           (error-buffer-name  (format <span class="org-string">"*Shell Error [%s]: %s*"</span> output-buffer-time command))
           (current-project    (project-current))
           (default-directory  (<span class="org-keyword">if</span> current-project
                                   (project-root current-project)
                                 default-directory)))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Run the command
</span>      (async-shell-command command output-buffer-name error-buffer-name)

      <span class="org-comment-delimiter">;; </span><span class="org-comment">Add process sentinel for completion notification
</span>      (<span class="org-keyword">when-let</span> ((proc (get-buffer-process output-buffer-name)))
        (set-process-sentinel
         proc
         (<span class="org-keyword">lambda</span> (process event)
           (<span class="org-keyword">when</span> (buffer-live-p (process-buffer process))
             (<span class="org-keyword">with-current-buffer</span> (process-buffer process)
               (<span class="org-keyword">let</span> ((inhibit-read-only t))
                 (goto-char (point-max))
                 (insert <span class="org-string">"\n"</span> (make-string 60 ?-) <span class="org-string">"\n"</span>)
                 (insert (format <span class="org-string">"Process %s %s"</span> (process-name process) (string-trim event)))
                 (insert (format <span class="org-string">" at %s\n"</span> (format-time-string <span class="org-string">"%Y-%m-%d %H:%M:%S"</span>)))
                 (<span class="org-keyword">when</span> (process-exit-status process)
                   (insert (format <span class="org-string">"Exit code: %s\n"</span> (process-exit-status process))))
                 (insert (make-string 60 ?-) <span class="org-string">"\n"</span>)))))))))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Bind to convenient key
</span>  (global-set-key (kbd <span class="org-string">"C-c !"</span>) #'fu/async-shell-command)
</pre>
</div>
</div>
</div>

<div id="outline-container-org87646e7" class="outline-3">
<h3 id="org87646e7"><span class="section-number-3">5.2.</span> Quick Shell Command in Project</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Run a quick shell command in the current project's root directory.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">fu/shell-command-in-project</span> (command)
  <span class="org-doc">"Run COMMAND synchronously in project root and display output."</span>
  (<span class="org-keyword">interactive</span> <span class="org-string">"sShell command in project: "</span>)
  (<span class="org-keyword">let*</span> ((project (project-current))
         (default-directory (<span class="org-keyword">if</span> project
                                (project-root project)
                              default-directory)))
    (shell-command command)))

(global-set-key (kbd <span class="org-string">"C-c |"</span>) #'fu/shell-command-in-project)
</pre>
</div>
</div>
</div>

<div id="outline-container-org96f81fd" class="outline-3">
<h3 id="org96f81fd"><span class="section-number-3">5.3.</span> Open External Terminal</h3>
<div class="outline-text-3" id="text-5-3">
<p>
Open an external terminal application in the current directory or project root.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">fu/open-external-terminal</span> ()
  <span class="org-doc">"Open external terminal in current directory or project root."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((dir (<span class="org-keyword">if-let</span> ((project (project-current)))
                 (project-root project)
               default-directory)))
    (<span class="org-keyword">cond</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">macOS
</span>     ((eq system-type 'darwin)
      (call-process <span class="org-string">"open"</span> nil 0 nil <span class="org-string">"-a"</span> <span class="org-string">"Terminal"</span> dir))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Linux with GNOME
</span>     ((<span class="org-keyword">and</span> (eq system-type 'gnu/linux)
           (executable-find <span class="org-string">"gnome-terminal"</span>))
      (call-process <span class="org-string">"gnome-terminal"</span> nil 0 nil
                   (concat <span class="org-string">"--working-directory="</span> dir)))
     <span class="org-comment-delimiter">;; </span><span class="org-comment">Linux with other terminal
</span>     ((executable-find <span class="org-string">"xterm"</span>)
      (start-process <span class="org-string">"xterm"</span> nil <span class="org-string">"xterm"</span> <span class="org-string">"-e"</span> <span class="org-string">"cd"</span> dir))
     (t
      (message <span class="org-string">"No external terminal configured for your system"</span>)))))

(global-set-key (kbd <span class="org-string">"C-c t x"</span>) #'fu/open-external-terminal)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5071e7c" class="outline-3">
<h3 id="org5071e7c"><span class="section-number-3">5.4.</span> DWIM Shell Command</h3>
<div class="outline-text-3" id="text-5-4">
<p>
A "Do What I Mean" shell command wrapper that intelligently operates on files in Dired or the current buffer. It provides powerful template placeholders for working with files and integrates seamlessly with Emacs workflows.
</p>

<p>
Features:
</p>
<ul class="org-ul">
<li>Smart file selection from Dired marked files or current buffer</li>
<li>Template placeholders for flexible command construction</li>
<li>Async execution with progress tracking</li>
<li>Works with single files, multiple files, or clipboard content</li>
<li>Automatic output buffer management</li>
</ul>

<p>
Template Placeholders:
</p>
<ul class="org-ul">
<li><code>&lt;&lt;f&gt;&gt;</code> : Current file or marked files (iterates for each file)</li>
<li><code>&lt;&lt;fne&gt;&gt;</code> : File name without extension</li>
<li><code>&lt;&lt;e&gt;&gt;</code> : File extension only</li>
<li><code>&lt;&lt;td&gt;&gt;</code> : Temporary directory</li>
<li><code>&lt;&lt;cb&gt;&gt;</code> : Clipboard content</li>
<li><code>&lt;&lt;*&gt;&gt;</code> : All marked files at once (not iterating)</li>
</ul>

<p>
Usage:
</p>
<ul class="org-ul">
<li><code>M-!</code> : Run DWIM shell command (remapped from <code>shell-command</code>)</li>
<li>In Dired: <code>!</code> runs command on marked files</li>
<li>Example: <code>convert &lt;&lt;f&gt;&gt; &lt;&lt;fne&gt;&gt;.png</code> converts images to PNG</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> dwim-shell-command
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (([remap shell-command] . dwim-shell-command)
         <span class="org-builtin">:map</span> dired-mode-map
         ([remap dired-do-async-shell-command] . dwim-shell-command)
         ([remap dired-do-shell-command] . dwim-shell-command)
         ([remap dired-smart-shell-command] . dwim-shell-command))
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Load additional command templates
</span>  (<span class="org-keyword">require</span> '<span class="org-constant">dwim-shell-commands</span> nil t))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org10e0281" class="outline-2">
<h2 id="org10e0281"><span class="section-number-2">6.</span> Agent Shell</h2>
<div class="outline-text-2" id="text-6">
<p>
A native Emacs interface to interact with LLM agents powered by ACP (Agent Client Protocol). Agent Shell enables chatting directly with AI coding assistants from within Emacs, supporting multiple providers while maintaining session state.
</p>
</div>

<div id="outline-container-org0f2cd87" class="outline-3">
<h3 id="org0f2cd87"><span class="section-number-3">6.1.</span> Agent Shell Core</h3>
<div class="outline-text-3" id="text-6-1">
<p>
The core agent-shell package provides the foundation for AI agent interaction in Emacs.
</p>

<p>
Features:
</p>
<ul class="org-ul">
<li>Native Emacs buffer for AI agent interaction</li>
<li>Built on <code>shell-maker</code> and <code>acp.el</code> for robust communication</li>
<li>Multiple provider support with unified interface</li>
<li>MCP (Model Context Protocol) server integration</li>
<li>Container and devcontainer execution support</li>
<li>Environment variable configuration (inherit, .env files)</li>
<li>Source block syntax highlighting</li>
<li>File completion and read/write capabilities</li>
<li>Screenshot capture support</li>
</ul>

<p>
Supported Agents:
</p>
<ul class="org-ul">
<li><b><b>Anthropic Claude Code</b></b>: <code>npm install -g @anthropic-ai/claude-code-acp</code></li>
<li><b><b>Google Gemini CLI</b></b>: Requires <code>--experimental-acp</code> flag support</li>
<li><b><b>OpenAI Codex</b></b>: <code>npm install -g @anthropic-ai/codex-acp</code></li>
<li><b><b>Goose CLI</b></b>: Standard installation from repository</li>
<li><b><b>Cursor Agent</b></b>: <code>npm install -g @blowmage/cursor-agent-acp</code></li>
<li><b><b>Qwen Code</b></b>: <code>npm install -g @anthropic-ai/qwen-code@latest</code></li>
</ul>

<p>
Usage:
</p>
<ul class="org-ul">
<li><code>M-x agent-shell</code> : Start agent shell (interactive agent selection)</li>
<li><code>C-u M-x agent-shell</code> : Force new session</li>
<li><code>M-x agent-shell-anthropic-start-claude-code</code> : Start Claude directly</li>
<li><code>M-x agent-shell-google-start-gemini</code> : Start Gemini directly</li>
<li><code>C-c C-c</code> : Interrupt current operation</li>
<li><code>TAB</code> / <code>S-TAB</code> : Navigate interactive elements</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Agent Shell - LLM agents via ACP in Emacs
</span>(<span class="org-keyword">use-package</span> agent-shell
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Display welcome message on start
</span>  (agent-shell-show-welcome-message nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable source block highlighting
</span>  (agent-shell-highlight-blocks t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable file completion
</span>  (agent-shell-file-completion-enabled t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable file read/write capabilities
</span>  (agent-shell-text-file-capabilities t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Show icons in agent selection
</span>  (agent-shell-show-config-icons t)
  (agent-shell-header-style 'graphical)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Set preferred/default agent (Claude Code)
</span>  (<span class="org-keyword">setq</span> agent-shell-preferred-agent-config
        (agent-shell-anthropic-make-claude-code-config))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Authentication for Anthropic (uses interactive login)
</span>  (<span class="org-keyword">setq</span> agent-shell-anthropic-authentication
        (agent-shell-anthropic-make-authentication <span class="org-builtin">:login</span> t))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Optional: Configure MCP servers
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq agent-shell-mcp-servers
</span>  <span class="org-comment-delimiter">;;       </span><span class="org-comment">'(((name . "filesystem")
</span>  <span class="org-comment-delimiter">;;          </span><span class="org-comment">(type . "stdio")
</span>  <span class="org-comment-delimiter">;;          </span><span class="org-comment">(command . "npx")
</span>  <span class="org-comment-delimiter">;;          </span><span class="org-comment">(args . ("-y" "@modelcontextprotocol/server-filesystem" "/path")))))
</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Optional: Environment variables (inherit from Emacs)
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq agent-shell-anthropic-claude-environment
</span>  <span class="org-comment-delimiter">;;       </span><span class="org-comment">(agent-shell-make-environment-variables :inherit-env t))
</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Optional: Devcontainer support
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq agent-shell-container-command-runner
</span>  <span class="org-comment-delimiter">;;       </span><span class="org-comment">'("devcontainer" "exec" "--workspace-folder" "."))
</span>  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org0cd8ae9" class="outline-3">
<h3 id="org0cd8ae9"><span class="section-number-3">6.2.</span> Agent Shell Manager</h3>
<div class="outline-text-3" id="text-6-2">
<p>
A buffer management tool for agent-shell that provides a tabulated list view of all open agent-shell buffers with real-time status monitoring and management capabilities.
</p>

<p>
Repository: <a href="https://github.com/jethrokuan/agent-shell-manager">jethrokuan/agent-shell-manager</a>
</p>

<p>
Features:
</p>
<ul class="org-ul">
<li>Tabulated display showing folder paths, status (ready/working/waiting/initializing/killed), session status, and mode</li>
<li>Auto-refresh capability (updates every 2 seconds)</li>
<li>Process controls for killing, restarting, and creating agent-shell instances</li>
<li>Session management with mode cycling and interrupt functions</li>
<li>Debugging utilities including traffic log viewing and ACP logging toggles</li>
<li>Visual organization with color-coded statuses and killed processes displayed separately</li>
</ul>

<p>
Usage:
</p>
<ul class="org-ul">
<li><code>M-x agent-shell-manager-toggle</code> : Toggle the manager interface</li>
<li><code>RET</code> : Switch to buffer</li>
<li><code>g</code> : Refresh the list</li>
<li><code>k</code> : Kill process</li>
<li><code>c</code> / <code>r</code> / <code>d</code> : Create / restart / delete buffers</li>
<li><code>m</code> / <code>M</code> : Set or cycle session mode</li>
<li><code>t</code> / <code>l</code> : View logs or toggle logging</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Agent Shell Manager - buffer management for agent-shell
</span>(<span class="org-keyword">use-package</span> agent-shell-manager
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:vc</span> (<span class="org-builtin">:url</span> <span class="org-string">"https://github.com/jethrokuan/agent-shell-manager"</span>
       <span class="org-builtin">:rev</span> <span class="org-builtin">:newest</span>)
  <span class="org-builtin">:after</span> agent-shell
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Window positioning: 'left, 'right, 'top, 'bottom, or nil
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">When nil, defers to display-buffer-alist
</span>  (agent-shell-manager-side 'right)
  <span class="org-builtin">:bind</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Convenient binding to open manager
</span>  (<span class="org-string">"C-c t m"</span> . agent-shell-manager-toggle))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8764ee" class="outline-3">
<h3 id="orge8764ee"><span class="section-number-3">6.3.</span> Agent Shell Sidebar</h3>
<div class="outline-text-3" id="text-6-3">
<p>
A persistent sidebar interface for agent-shell, providing a treemacs-like side panel for interacting with LLM agents. The sidebar is project-aware and maintains state across visibility toggles.
</p>

<p>
Repository: <a href="https://github.com/cmacrae/agent-shell-sidebar">cmacrae/agent-shell-sidebar</a>
</p>

<p>
Requirements:
</p>
<ul class="org-ul">
<li>Emacs 29.1 or later</li>
<li>agent-shell 0.5.1 or newer</li>
</ul>

<p>
Features:
</p>
<ul class="org-ul">
<li>Project-aware with individual sidebar state per project</li>
<li>Persistent sidebar that maintains state across visibility toggles</li>
<li>Configurable width, position (left/right), and locking behavior</li>
<li>Locked sidebars adapt automatically to frame size changes</li>
</ul>

<p>
Usage:
</p>
<ul class="org-ul">
<li><code>M-x agent-shell-sidebar-toggle</code> : Toggle sidebar visibility for current project</li>
<li><code>M-x agent-shell-sidebar-switch-to-buffer</code> : Switch focus between sidebar and other buffers</li>
<li><code>M-x agent-shell-sidebar-set-config</code> : Change LLM provider on demand</li>
<li><code>M-x agent-shell-sidebar-reset</code> : Reset sidebar state</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Agent Shell Sidebar - persistent sidebar for agent-shell
</span>(<span class="org-keyword">use-package</span> agent-shell-sidebar
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:vc</span> (<span class="org-builtin">:url</span> <span class="org-string">"https://github.com/cmacrae/agent-shell-sidebar"</span>
       <span class="org-builtin">:rev</span> <span class="org-builtin">:newest</span>)
  <span class="org-builtin">:after</span> agent-shell
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Panel width (integer or percentage string)
</span>  (agent-shell-sidebar-width <span class="org-string">"25%"</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Minimum width threshold
</span>  (agent-shell-sidebar-minimum-width 80)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Maximum width limit
</span>  (agent-shell-sidebar-maximum-width <span class="org-string">"50%"</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Placement: 'left or 'right
</span>  (agent-shell-sidebar-position 'right)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Fixed vs. resizable mode
</span>  (agent-shell-sidebar-locked t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Optional: Set default LLM provider
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">(agent-shell-sidebar-default-config
</span>  <span class="org-comment-delimiter">;;  </span><span class="org-comment">(agent-shell-anthropic-make-claude-code-config))
</span>  <span class="org-builtin">:bind</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Toggle sidebar
</span>  (<span class="org-string">"C-c t s"</span> . agent-shell-sidebar-toggle))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6b1a5dd" class="outline-2">
<h2 id="org6b1a5dd"><span class="section-number-2">7.</span> End of File</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">provide</span> '<span class="org-constant">shell-conf</span>)
<span class="org-comment-delimiter">;;; </span><span class="org-comment">shell-conf.el ends here</span>
</pre>
</div>
</div>
</div>
</main>
</body>
</html>
