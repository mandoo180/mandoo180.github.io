<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org Mode" />
<meta name="viewport" content="width=device-width, initial-scale=1"><script src="https://cdn.tailwindcss.com?plugins=typography"></script><script>window.tailwind = window.tailwind || {};window.tailwind.config = { darkMode: 'media' }; /* follow browser */</script>
<style>
  :root { color-scheme: light dark; }      /* hint to UA widgets, form controls */
  body { margin:0; }
  @media (prefers-color-scheme: light) { body { background: #ffffff; } }
  @media (prefers-color-scheme: dark)  { body { background: #0b0b0b; } }
</style><link rel="stylesheet" href="/assets/styles/toc-sidebar.css"><script src="/assets/scripts/toc-sidebar.js" defer></script>
</head>
<body>
<main id="content" class="prose prose-zinc dark:prose-invert mx-auto w-full max-w-xl md:max-w-xl lg:max-w-2xl xl:max-w-3xl px-4 sm:px-6 lg:px-8">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgefed607">1. Introduction</a></li>
<li><a href="#org65d657b">2. Org Mode Core Configuration</a></li>
<li><a href="#org5b5b204">3. Org Download</a></li>
<li><a href="#org2463bb4">4. Org Appear (Disabled)</a></li>
<li><a href="#org67d1621">5. Pretty Org - Visual Enhancements</a>
<ul>
<li><a href="#org8d617c4">5.1. Org Modern</a></li>
</ul>
</li>
<li><a href="#orgb9d5c24">6. Org Google Calendar</a></li>
<li><a href="#org9c6cee9">7. Org Remote Images</a></li>
<li><a href="#orgbdcef47">8. Org-Roam Configuration</a>
<ul>
<li><a href="#org99abeab">8.1. Core Setup</a></li>
<li><a href="#orgddf6e23">8.2. Capture Templates</a></li>
<li><a href="#org0b04f26">8.3. Daily Notes Configuration</a></li>
<li><a href="#orgf809d4c">8.4. Enhanced Node Display</a></li>
<li><a href="#org63367e7">8.5. Graph Visualization</a></li>
<li><a href="#org58b5586">8.6. UI Enhancement with org-roam-ui</a></li>
<li><a href="#org9551282">8.7. Performance Optimizations</a></li>
<li><a href="#org91b7646">8.8. Best Practices Summary</a></li>
<li><a href="#org5220ae1">8.9. Common Workflows</a>
<ul>
<li><a href="#orgd954c42">8.9.1. Creating a New Note</a></li>
<li><a href="#org183e535">8.9.2. Linking Notes</a></li>
<li><a href="#orge2d1330">8.9.3. Daily Journaling</a></li>
<li><a href="#orgd9945ff">8.9.4. Reviewing Connections</a></li>
<li><a href="#org3a6de26">8.9.5. Deleting Notes Safely</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org978c848">9. End of File</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgefed607" class="outline-2">
<h2 id="orgefed607"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
Configuration for Org-mode and knowledge management tools including org-roam, org-gcal, and related packages.
</p>
</div>
</div>

<div id="outline-container-org65d657b" class="outline-2">
<h2 id="org65d657b"><span class="section-number-2">2.</span> Org Mode Core Configuration</h2>
<div class="outline-text-2" id="text-2">
<p>
Core Org-mode settings including babel languages, templates, and basic customization.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">doc-org-conf.el --- Org-mode and knowledge management configuration  -*- lexical-binding: t; -*-
</span><span class="org-comment-delimiter">;;; </span><span class="org-comment">Commentary:
</span><span class="org-comment-delimiter">;;; </span><span class="org-comment">Code:
</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Configure browser for opening URLs (fixes LaTeXiT issue on macOS)
</span>(<span class="org-keyword">setq</span> browse-url-browser-function 'browse-url-default-macosx-browser)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Required packages for org extensions
</span>(<span class="org-keyword">use-package</span> org-contrib)
(<span class="org-keyword">use-package</span> ob-typescript)
(<span class="org-keyword">use-package</span> ob-powershell)
(<span class="org-keyword">use-package</span> ob-http)
(<span class="org-keyword">use-package</span> ob-restclient)

(<span class="org-keyword">use-package</span> org
  <span class="org-builtin">:pin</span> org
  <span class="org-builtin">:commands</span> (org-capture org-agenda)
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Agenda and logging
</span>  (org-agenda-start-with-log-mode t)
  (org-log-done 'time)
  (org-log-into-drawer t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Editing behavior
</span>  (org-catch-invisible-edits 'show)
  (org-edit-timestamp-down-means-later t)
  (org-fast-tag-selection-single-key 'expert)
  (org-src-window-setup 'current-window)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Export settings
</span>  (org-export-coding-system 'utf-8)
  (org-export-kill-product-buffer-when-displayed t)
  (org-html-validation-link nil)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">LaTeX export
</span>  (org-latex-compiler <span class="org-string">"xelatex"</span>)
  (org-latex-pdf-process '(<span class="org-string">"latexmk -xelatex -synctex=1 -f -interaction=nonstopmode -output-directory=%o %f"</span>))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Display and appearance
</span>  (org-hide-emphasis-markers t)
  (org-pretty-entities nil)
  (org-startup-indented nil)
  (org-startup-with-inline-images t)
  (org-display-remote-inline-images 'download)
  (org-image-actual-width '(450))
  (org-tags-column 80)
  <span class="org-builtin">:hook</span>
  ((org-mode-hook . olivetti-mode))
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Load org-tempo for easy template expansion
</span>  (<span class="org-keyword">require</span> '<span class="org-constant">org-tempo</span>)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Load babel language support
</span>  (<span class="org-keyword">require</span> '<span class="org-constant">ob-js</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">ob-typescript</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">ob-ruby</span>)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Add custom structure templates
</span>  (add-to-list 'org-structure-template-alist '(<span class="org-string">"txt"</span>  . <span class="org-string">"src text"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"cc"</span>   . <span class="org-string">"src C"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"sh"</span>   . <span class="org-string">"src shell"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"zsh"</span>  . <span class="org-string">"src zsh"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"bash"</span> . <span class="org-string">"src bash"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"posh"</span> . <span class="org-string">"src powershell"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"el"</span>   . <span class="org-string">"src emacs-lisp"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"py"</span>   . <span class="org-string">"src python"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"js"</span>   . <span class="org-string">"src js"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"ts"</span>   . <span class="org-string">"src typescript"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"java"</span> . <span class="org-string">"src java"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"scm"</span>  . <span class="org-string">"src scheme"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"sql"</span>  . <span class="org-string">"src sql"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"rust"</span> . <span class="org-string">"src rust"</span>))
  (add-to-list 'org-structure-template-alist '(<span class="org-string">"rb"</span>   . <span class="org-string">"src ruby"</span>))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable babel languages - only load those that are available
</span>  (org-babel-do-load-languages
   'org-babel-load-languages
   (seq-filter
    (<span class="org-keyword">lambda</span> (pair)
      (locate-library (concat <span class="org-string">"ob-"</span> (symbol-name (car pair)))))
    '((dot        . t)
      (C          . t)
      (gnuplot    . t)
      (latex      . t)
      (python     . t)
      (js         . t)
      (typescript . t)
      (shell      . t)
      (zsh        . t)
      (bash       . t)
      (posh       . t)
      (powershell . t)
      (scheme     . t)
      (sql        . t)
      (sqlite     . t)
      (ruby       . t)
      (emacs-lisp . t)
      (http       . t)
      (restclient . t))))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Fix electric-pair-mode for org-mode angle brackets
</span>  (<span class="org-keyword">defun</span> <span class="org-function-name">handle-electric-pair-inhibit</span> (c)
    (<span class="org-keyword">if</span> (char-equal c ?&lt;) t (,electric-pair-inhibit-predicate c)))

  (<span class="org-keyword">defun</span> <span class="org-function-name">handle-org-mode-hook</span>()
    (<span class="org-keyword">setq-local</span> electric-pair-inhibit-predicate #'handle-electric-pair-inhibit))

  (add-hook 'org-mode-hook #'handle-org-mode-hook)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Load org-remoteimg for remote image display
</span>  (add-to-list 'load-path (expand-file-name <span class="org-string">"elisp/settings"</span> user-emacs-directory))
  (<span class="org-keyword">require</span> '<span class="org-constant">org-remoteimg</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b5b204" class="outline-2">
<h2 id="org5b5b204"><span class="section-number-2">3.</span> Org Download</h2>
<div class="outline-text-2" id="text-3">
<p>
Drag-and-drop images and screenshots into org buffers.
Automatically skipped on server/headless environments (requires GUI for screenshots).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-download
    <span class="org-builtin">:after</span> org
    <span class="org-builtin">:custom</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Store images in a local "images" directory
</span>    (org-download-image-dir <span class="org-string">"images"</span>)

    <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't create heading-based subdirectories
</span>    (org-download-heading-lvl nil)

    <span class="org-comment-delimiter">;; </span><span class="org-comment">Screenshot method based on OS
</span>    (org-download-screenshot-method
     (<span class="org-keyword">cond</span> ((eq system-type 'darwin) <span class="org-string">"screencapture -i %s"</span>)
           ((eq system-type 'gnu/linux) <span class="org-string">"scrot -s %s"</span>)))

    <span class="org-builtin">:config</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable inline display of remote images
</span>    (<span class="org-keyword">setq</span> org-download-display-inline-images 'posframe))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2463bb4" class="outline-2">
<h2 id="org2463bb4"><span class="section-number-2">4.</span> Org Appear (Disabled)</h2>
<div class="outline-text-2" id="text-4">
<p>
Shows hidden emphasis markers and links when cursor is on them. Currently disabled.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-appear
  <span class="org-builtin">:hook</span>
  (org-mode . org-appear-mode)
  <span class="org-builtin">:custom</span>
  (org-appear-autoemphasis t)
  (org-appear-autolinks t)
  (org-appear-autosubmarkers t)
  (org-appear-autoentities t)
  (org-appear-autokeywords t)
  (org-appear-inside-latex t)
  (org-appear-delay 0.0)
  (org-appear-trigger 'always))
</pre>
</div>
</div>
</div>

<div id="outline-container-org67d1621" class="outline-2">
<h2 id="org67d1621"><span class="section-number-2">5.</span> Pretty Org - Visual Enhancements</h2>
<div class="outline-text-2" id="text-5">
<p>
Modern, beautiful styling for Org-mode with enhanced typography, icons, and visual elements.
</p>
</div>

<div id="outline-container-org8d617c4" class="outline-3">
<h3 id="org8d617c4"><span class="section-number-3">5.1.</span> Org Modern</h3>
<div class="outline-text-3" id="text-5-1">
<p>
The <code>org-modern</code> package provides a clean, modern appearance for Org-mode with better typography, styling, and visual hierarchy.
</p>

<p>
Features:
</p>
<ul class="org-ul">
<li>Modern table styling with proper borders</li>
<li>Beautiful heading styles with custom fonts</li>
<li>Enhanced todo keywords and priorities</li>
<li>Styled tags, timestamps, and statistics</li>
<li>Better block delimiters</li>
<li>Improved checkbox appearance</li>
<li>Clean list bullets</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Modern Org-mode styling
</span>(<span class="org-keyword">use-package</span> org-modern
  <span class="org-builtin">:hook</span>
  (org-mode . org-modern-mode)
  (org-agenda-finalize . org-modern-agenda)
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Heading styles
</span>  (org-modern-star 'replace)
  (org-modern-hide-stars t)
  (org-modern-table t)
  (org-modern-table-vertical 1)
  (org-modern-table-horizontal 0.2)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">List bullets
</span>  (org-modern-list '((43 . <span class="org-string">"&#10148;"</span>)   <span class="org-comment-delimiter">; </span><span class="org-comment">+
</span>                     (45 . <span class="org-string">"&#8211;"</span>)   <span class="org-comment-delimiter">; </span><span class="org-comment">-
</span>                     (42 . <span class="org-string">"&#8226;"</span>))) <span class="org-comment-delimiter">; </span><span class="org-comment">*
</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Block delimiters
</span>  (org-modern-block-name '((<span class="org-string">"src"</span> <span class="org-string">"&#187;"</span> <span class="org-string">"&#171;"</span>)
                          (<span class="org-string">"example"</span> <span class="org-string">"&#187;&#8211;"</span> <span class="org-string">"&#8211;&#171;"</span>)
                          (<span class="org-string">"quote"</span> <span class="org-string">"&#10077;"</span> <span class="org-string">"&#10078;"</span>)
                          (<span class="org-string">"export"</span> <span class="org-string">"&#9193;"</span> <span class="org-string">"&#9194;"</span>)))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Keywords styling
</span>  (org-modern-keyword t)
  (org-modern-checkbox nil)
  (org-modern-horizontal-rule t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Timestamps
</span>  (org-modern-timestamp t)
  (org-modern-statistics t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Tags
</span>  (org-modern-tag t)
  (org-modern-priority t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Todo keywords
</span>  (org-modern-todo t)
  (org-modern-todo-faces
   '((<span class="org-string">"TODO"</span> <span class="org-builtin">:background</span> <span class="org-string">"#ff6c6b"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#282c34"</span> <span class="org-builtin">:weight</span> bold)
     (<span class="org-string">"NEXT"</span> <span class="org-builtin">:background</span> <span class="org-string">"#51afef"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#282c34"</span> <span class="org-builtin">:weight</span> bold)
     (<span class="org-string">"WAIT"</span> <span class="org-builtin">:background</span> <span class="org-string">"#ecbe7b"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#282c34"</span> <span class="org-builtin">:weight</span> bold)
     (<span class="org-string">"DONE"</span> <span class="org-builtin">:background</span> <span class="org-string">"#98be65"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#282c34"</span> <span class="org-builtin">:weight</span> bold)
     (<span class="org-string">"CANCEL"</span> <span class="org-builtin">:background</span> <span class="org-string">"#5B6268"</span> <span class="org-builtin">:foreground</span> <span class="org-string">"#282c34"</span> <span class="org-builtin">:weight</span> bold))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb9d5c24" class="outline-2">
<h2 id="orgb9d5c24"><span class="section-number-2">6.</span> Org Google Calendar</h2>
<div class="outline-text-2" id="text-6">
<p>
Bidirectional sync between Org-mode and Google Calendar. Disabled for now.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-gcal
  <span class="org-builtin">:after</span> org
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">IMPORTANT: Set these variables in your private.el or custom-vars.el:
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq org-gcal-client-id "your-client-id-from-google-console.apps.googleusercontent.com")
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq org-gcal-client-secret "your-client-secret-from-google-console")
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq org-gcal-file-alist '(("your-email@gmail.com" . "~/org/gcal.org")
</span>  <span class="org-comment-delimiter">;;                              </span><span class="org-comment">("another-calendar@gmail.com" . "~/org/work-gcal.org")))
</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Directory to store OAuth token and sync metadata
</span>  (org-gcal-dir (expand-file-name <span class="org-string">".org-gcal/"</span> user-emacs-directory))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Token storage - use plain text file (no .gpg extension) to avoid encryption
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">The token file will have restricted file permissions (600) for security
</span>  (org-gcal-token-file (expand-file-name <span class="org-string">".org-gcal/token"</span> user-emacs-directory))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Automatically fetch events when opening org-agenda
</span>  (org-gcal-auto-archive nil)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Notify on sync
</span>  (org-gcal-notify-p t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Update events if they already exist (bidirectional sync)
</span>  (org-gcal-update-cancelled-events-with-todo t)

  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">CRITICAL: Disable plstore encryption BEFORE org-gcal loads
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">This must be in :init, not :config
</span>  (<span class="org-keyword">setq</span> plstore-cache-passphrase-for-symmetric-encryption t)
  (<span class="org-keyword">setq</span> plstore-encrypt-to nil)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Ensure EPG context doesn't prompt for passphrase
</span>  (<span class="org-keyword">setq</span> epg-pinentry-mode 'loopback)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Auto-provide a passphrase if encryption can't be disabled
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">This prevents repeated prompts
</span>  (<span class="org-keyword">defvar</span> <span class="org-variable-name">my/org-gcal-passphrase</span> <span class="org-string">"emacs-gcal-token"</span>)
  (<span class="org-keyword">defun</span> <span class="org-function-name">my/org-gcal-passphrase-callback</span> (context key-id handback)
    <span class="org-doc">"Automatically provide passphrase for org-gcal token encryption."</span>
    my/org-gcal-passphrase)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Override EPG passphrase callback
</span>  (<span class="org-keyword">setq</span> epg-passphrase-callback-function #'my/org-gcal-passphrase-callback)

  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Additional workaround: advice plstore to disable encryption
</span>  (<span class="org-keyword">when</span> (fboundp 'plstore-open)
    (advice-add 'plstore-open <span class="org-builtin">:around</span>
                (<span class="org-keyword">lambda</span> (orig-fun file)
                  (<span class="org-keyword">let</span> ((plstore-encrypt-to nil))
                    (funcall orig-fun file)))))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Add org-gcal files to org-agenda-files if configured
</span>  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (boundp 'org-gcal-file-alist) org-gcal-file-alist)
    (<span class="org-keyword">dolist</span> (calendar org-gcal-file-alist)
      (<span class="org-keyword">let</span> ((gcal-file (cdr calendar)))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Create the file if it doesn't exist
</span>        (<span class="org-keyword">unless</span> (file-exists-p gcal-file)
          (make-directory (file-name-directory gcal-file) t)
          (write-region <span class="org-string">""</span> nil gcal-file))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Add to org-agenda-files if not already there
</span>        (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (boundp 'org-agenda-files)
                   (not (member gcal-file org-agenda-files)))
          (add-to-list 'org-agenda-files gcal-file)))))

  <span class="org-builtin">:bind</span>
  ((<span class="org-string">"C-c g p"</span> . org-gcal-post-at-point)
   (<span class="org-string">"C-c g d"</span> . org-gcal-delete-at-point)
   (<span class="org-string">"C-c g r"</span> . org-gcal-refresh-token)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c6cee9" class="outline-2">
<h2 id="org9c6cee9"><span class="section-number-2">7.</span> Org Remote Images</h2>
<div class="outline-text-2" id="text-7">
<p>
Display remote HTTP/HTTPS images inline in org buffers with automatic caching.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">org-remoteimg.el --- Display remote inline images in org-mode -*- lexical-binding: t -*-
</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Copyright (C) 2023 Dean Gao - MIT License
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">Author: Dean Gao <a href="mailto:gao.dean%40hotmail.com">&lt;gao.dean@hotmail.com&gt;</a>
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">Description: Inline display of remote images in org-mode
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">Homepage: https://github.com/gaoDean/org-imgtog
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">Package-Requires: ((emacs "25.1"))
</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Permission is hereby granted, free of charge, to any person obtaining a copy
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">of this software and associated documentation files (the "Software"), to deal
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">in the Software without restriction, including without limitation the rights
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">copies of the Software, and to permit persons to whom the Software is
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">furnished to do so, subject to the following conditions:
</span><span class="org-comment-delimiter">;;</span><span class="org-comment">
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">The above copyright notice and this permission notice shall be included in all
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">copies or substantial portions of the Software.
</span><span class="org-comment-delimiter">;;</span><span class="org-comment">
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">SOFTWARE.
</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">Commentary:
</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">This package displays remote images inline in org-mode with automatic caching.
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">This means you can do \[\[https://my-file.png\]\], and have it display inline.
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">The next time you visit the file or fetch the image, it will be instantly
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">fetched from the cache.
</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">Code:
</span>
(<span class="org-keyword">require</span> '<span class="org-constant">org</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">org-element</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">url</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">url-cache</span>)

(<span class="org-keyword">unless</span> (fboundp 'image-supported-file-p)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">`</span><span class="org-comment"><span class="org-constant">image-supported-file-p</span></span><span class="org-comment">' isn't available before Emacs 28
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">Add alias to not break Emacs &lt;28.
</span>  (<span class="org-keyword">defalias</span> '<span class="org-function-name">image-type-from-file-name</span> 'image-supported-file-p))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Compatibility definitions for Org-mode &lt; 9.8
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">In Org &lt; 9.8, the variable is called org-inline-image-overlays
</span><span class="org-comment-delimiter">;; </span><span class="org-comment">In Org &gt;= 9.8, it was renamed to org-link-preview-overlays
</span>(<span class="org-keyword">unless</span> (boundp 'org-link-preview-overlays)
  (<span class="org-keyword">defvaralias</span> '<span class="org-variable-name">org-link-preview-overlays</span> 'org-inline-image-overlays
    <span class="org-doc">"Compatibility alias for org-inline-image-overlays in Org &lt; 9.8."</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-image-update-overlay</span> (file link <span class="org-type">&amp;optional</span> data-p refresh)
  <span class="org-doc">"Create image overlay for FILE associtated with org-element LINK.
If DATA-P is non-nil FILE is not a file name but a string with the image data.
If REFRESH is non-nil don't download the file but refresh the image.
See also `</span><span class="org-doc"><span class="org-constant">create-image</span></span><span class="org-doc">'.
This function is almost a duplicate of a part of `</span><span class="org-doc"><span class="org-constant">org-display-inline-images</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> data-p (file-exists-p file))
    (<span class="org-keyword">let</span> ((width
           <span class="org-comment-delimiter">;; </span><span class="org-comment">Apply `</span><span class="org-comment"><span class="org-constant">org-image-actual-width</span></span><span class="org-comment">' specifications.
</span>           (<span class="org-keyword">cond</span>
            ((eq org-image-actual-width t) nil)
            ((listp org-image-actual-width)
             (<span class="org-keyword">or</span>
              <span class="org-comment-delimiter">;; </span><span class="org-comment">First try to find a width among
</span>              <span class="org-comment-delimiter">;; </span><span class="org-comment">attributes associated to the paragraph
</span>              <span class="org-comment-delimiter">;; </span><span class="org-comment">containing link.
</span>              (<span class="org-keyword">let</span> ((paragraph
                     (<span class="org-keyword">let</span> ((e link))
                       (<span class="org-keyword">while</span> (<span class="org-keyword">and</span> (<span class="org-keyword">setq</span> e (org-element-property
                                            <span class="org-builtin">:parent</span> e))
                                   (not (eq (org-element-type e)
                                            'paragraph))))
                       e)))
                (<span class="org-keyword">when</span> paragraph
                  (<span class="org-keyword">save-excursion</span>
                    (goto-char (org-element-property <span class="org-builtin">:begin</span> paragraph))
                    (<span class="org-keyword">when</span>
                        (re-search-forward
                         <span class="org-string">"^[ \t]*#\\+attr_.*?: +.*?:width +</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">\\S-+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
                         (org-element-property
                          <span class="org-builtin">:post-affiliated</span> paragraph)
                         t)
                      (string-to-number (match-string 1))))))
              <span class="org-comment-delimiter">;; </span><span class="org-comment">Otherwise, fall-back to provided number.
</span>              (car org-image-actual-width)))
            ((numberp org-image-actual-width)
             org-image-actual-width)))
          (old (get-char-property-and-overlay
                (org-element-property <span class="org-builtin">:begin</span> link)
                'org-image-overlay)))
      (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (car-safe old) refresh)
          (image-flush (overlay-get (cdr old) 'display))
        (<span class="org-keyword">let</span> ((image (create-image file
                                   (<span class="org-keyword">and</span> (image-type-available-p 'imagemagick)
                                        width
                                        'imagemagick)
                                   data-p
                                   <span class="org-builtin">:width</span> width)))
          (<span class="org-keyword">when</span> image
            (<span class="org-keyword">let*</span> ((link
                    <span class="org-comment-delimiter">;; </span><span class="org-comment">If inline image is the description
</span>                    <span class="org-comment-delimiter">;; </span><span class="org-comment">of another link, be sure to
</span>                    <span class="org-comment-delimiter">;; </span><span class="org-comment">consider the latter as the one to
</span>                    <span class="org-comment-delimiter">;; </span><span class="org-comment">apply the overlay on.
</span>                    (<span class="org-keyword">let</span> ((parent
                           (org-element-property <span class="org-builtin">:parent</span> link)))
                      (<span class="org-keyword">if</span> (eq (org-element-type parent) 'link)
                          parent
                        link)))
                   (ov (make-overlay
                        (org-element-property <span class="org-builtin">:begin</span> link)
                        (<span class="org-keyword">progn</span>
                          (goto-char
                           (org-element-property <span class="org-builtin">:end</span> link))
                          (skip-chars-backward <span class="org-string">" \t"</span>)
                          (point)))))
              (overlay-put ov 'display image)
              (overlay-put ov 'face 'default)
              (overlay-put ov 'org-image-overlay t)
              (overlay-put
               ov 'modification-hooks
               (list 'org-display-inline-remove-overlay))
              (<span class="org-keyword">push</span> ov org-link-preview-overlays)
              ov)))))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-display-user-inline-images</span> (<span class="org-type">&amp;optional</span> _include-linked _refresh beg end)
  <span class="org-doc">"Like `</span><span class="org-doc"><span class="org-constant">org-display-inline-images</span></span><span class="org-doc">' but for image data links.
_INCLUDE-LINKED and _REFRESH are ignored.
Restrict to region between BEG and END if both are non-nil.
Image data links have a :image-data-fun parameter.
\(See `</span><span class="org-doc"><span class="org-constant">org-link-set-parameters</span></span><span class="org-doc">'.)
The value of the :image-data-fun parameter is a function
taking the PROTOCOL, the LINK, and the DESCRIPTION as arguments.
If that function returns nil the link is not interpreted as image.
Otherwise the return value is the image data string to be displayed.

Note that only bracket links are allowed as image data links
with one of the formats
 [[PROTOCOL:LINK]]
or
 [[PROTOCOL:LINK][DESCRIPTION]]
are recognized.
Full credit goes to org-yt by Tobias Zawada for this function."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (called-interactively-p 'any)
             (use-region-p))
    (<span class="org-keyword">setq</span> beg (region-beginning)
          end (region-end)))
  (<span class="org-keyword">when</span> (display-graphic-p)
    (<span class="org-keyword">org-with-wide-buffer</span>
     (goto-char (<span class="org-keyword">or</span> beg (point-min)))
     (<span class="org-keyword">when-let*</span> ((image-data-link-parameters
               (<span class="org-keyword">cl-loop</span> for link-par-entry in org-link-parameters
                        with fun
                        when (<span class="org-keyword">setq</span> fun (plist-get (cdr link-par-entry) <span class="org-builtin">:image-data-fun</span>))
                        collect (cons (car link-par-entry) fun)))
              (image-data-link-re (regexp-opt (mapcar 'car image-data-link-parameters)))
              (re (format <span class="org-string">"\\[\\[</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">%s</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">]]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">\\[</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">]]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\\]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?\\]"</span>
                          image-data-link-re)))
       (<span class="org-keyword">while</span> (re-search-forward re end t)
         (<span class="org-keyword">let*</span> ((protocol (match-string-no-properties 1))
              (link (match-string-no-properties 2))
              (description (match-string-no-properties 3))
              (image-data-link (assoc-string protocol image-data-link-parameters))
              (el (<span class="org-keyword">save-excursion</span> (goto-char (match-beginning 1)) (org-element-context)))
              image-data)
           (<span class="org-keyword">when</span> el
             (<span class="org-keyword">setq</span> image-data
                   (<span class="org-keyword">or</span> (<span class="org-keyword">let</span> ((old (get-char-property-and-overlay
                                   (org-element-property <span class="org-builtin">:begin</span> el)
                                   'org-image-overlay)))
                         (<span class="org-keyword">and</span> old
                              (car-safe old)
                              (overlay-get (cdr old) 'display)))
                     (funcall (cdr image-data-link) protocol link description)))
             (<span class="org-keyword">when</span> image-data
               (<span class="org-keyword">let</span> ((ol (org-image-update-overlay image-data el t t)))
                 (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> ol description)
                   (overlay-put ol 'after-string description)))))))))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-remoteimg--fetch-image</span> (protocol link _description)
  <span class="org-doc">"Synchronously retrieve image from cache or web."</span>
  (<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (image-supported-file-p link)
             (not (eq org-display-remote-inline-images 'skip)))
    (<span class="org-keyword">let*</span> ((cache (eq org-display-remote-inline-images 'cache))
           (url-automatic-caching (<span class="org-keyword">if</span> cache
                                      t
                                    url-automatic-caching))
           (url (concat protocol <span class="org-string">":"</span> link))
           (silent-output (file-exists-p (url-cache-create-filename url))))
      (<span class="org-keyword">if-let*</span> ((buf (url-retrieve-synchronously url
                                                   silent-output
                                                   nil
                                                   30)))
              (<span class="org-keyword">with-current-buffer</span> buf
                (goto-char (point-min))
                (re-search-forward <span class="org-string">"\r?\n\r?\n"</span> nil t)
                (buffer-substring-no-properties (point) (point-max)))
            (<span class="org-warning">error</span> <span class="org-string">"Download of image \"%s\" failed"</span> link)
            nil))))

(<span class="org-keyword">defun</span> <span class="org-function-name">org-link-preview-http</span> (ov _path link)
  <span class="org-doc">"Generate preview OV for LINK in PATH."</span>
  (<span class="org-keyword">when-let*</span> ((raw-link (org-element-property <span class="org-builtin">:raw-link</span> link))
              (image-type (image-supported-file-p raw-link))
              <span class="org-comment-delimiter">;; </span><span class="org-comment">cache?
</span>              (image-buffer (org-remoteimg--fetch-image nil raw-link nil)))
        (overlay-put ov 'display (create-image image-buffer
                                      <span class="org-comment-delimiter">;; </span><span class="org-comment">scale?
</span>                                   <span class="org-comment-delimiter">;; </span><span class="org-comment">(and (image-type-available-p 'imagemagick)
</span>                                   <span class="org-comment-delimiter">;;      </span><span class="org-comment">width
</span>                                   <span class="org-comment-delimiter">;;      </span><span class="org-comment">'imagemagick)
</span>                                                             <span class="org-comment-delimiter">;; </span><span class="org-comment">:width width
</span>                                                             image-type
                                                             t))
        t))

(<span class="org-keyword">if</span> (fboundp 'org-display-inline-images)
    (<span class="org-keyword">progn</span>
      (advice-add #'org-display-inline-images <span class="org-builtin">:after</span> #'org-display-user-inline-images)
      (org-link-set-parameters <span class="org-string">"http"</span>  <span class="org-builtin">:image-data-fun</span> #'org-remoteimg--fetch-image)
      (org-link-set-parameters <span class="org-string">"https"</span> <span class="org-builtin">:image-data-fun</span> #'org-remoteimg--fetch-image))
  (org-link-set-parameters <span class="org-string">"http"</span> <span class="org-builtin">:preview</span> #'org-link-preview-http)
  (org-link-set-parameters <span class="org-string">"https"</span> <span class="org-builtin">:preview</span> #'org-link-preview-http))

(<span class="org-keyword">provide</span> '<span class="org-constant">org-remoteimg</span>)

<span class="org-comment-delimiter">;;; </span><span class="org-comment">org-remoteimg.el ends here
</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbdcef47" class="outline-2">
<h2 id="orgbdcef47"><span class="section-number-2">8.</span> Org-Roam Configuration</h2>
<div class="outline-text-2" id="text-8">
<p>
Org-roam is a powerful Zettelkasten-style note-taking system built on top of Org-mode. It enables networked thought through bidirectional linking and provides tools for knowledge management inspired by Roam Research.
</p>
</div>

<div id="outline-container-org99abeab" class="outline-3">
<h3 id="org99abeab"><span class="section-number-3">8.1.</span> Core Setup</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-roam
  <span class="org-builtin">:after</span> org
  <span class="org-builtin">:demand</span> t
  <span class="org-builtin">:init</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Ensure org-roam directory exists before package loads
</span>  (<span class="org-keyword">let</span> ((roam-dir (file-truename <span class="org-string">"~/org-roam/"</span>)))
    (<span class="org-keyword">unless</span> (file-directory-p roam-dir)
      (make-directory roam-dir t)))
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Directory where all your notes will be stored
</span>  (org-roam-directory (file-truename <span class="org-string">"~/org-roam/"</span>))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Better database location (avoid cluttering org-roam directory)
</span>  (org-roam-db-location (expand-file-name <span class="org-string">"org-roam.db"</span> user-emacs-directory))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable completion everywhere (for inserting links)
</span>  (org-roam-completion-everywhere t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Configure how nodes are displayed in completion
</span>  (org-roam-node-display-template
   (concat <span class="org-string">"${title:*} "</span> (propertize <span class="org-string">"${tags:10}"</span> 'face 'org-tag)))

  <span class="org-builtin">:bind</span>
  ((<span class="org-string">"C-c n l"</span> . org-roam-buffer-toggle)         <span class="org-comment-delimiter">;; </span><span class="org-comment">Show backlinks sidebar
</span>   (<span class="org-string">"C-c n f"</span> . org-roam-node-find)             <span class="org-comment-delimiter">;; </span><span class="org-comment">Find or create a note
</span>   (<span class="org-string">"C-c n i"</span> . org-roam-node-insert)           <span class="org-comment-delimiter">;; </span><span class="org-comment">Insert a link to a note
</span>   (<span class="org-string">"C-c n c"</span> . org-roam-capture)               <span class="org-comment-delimiter">;; </span><span class="org-comment">Quick capture
</span>   (<span class="org-string">"C-c n j"</span> . org-roam-dailies-capture-today) <span class="org-comment-delimiter">;; </span><span class="org-comment">Daily note
</span>   (<span class="org-string">"C-c n g"</span> . org-roam-graph)                 <span class="org-comment-delimiter">;; </span><span class="org-comment">Visualize the graph
</span>   <span class="org-builtin">:map</span> org-mode-map
   (<span class="org-string">"C-M-i"</span>   . completion-at-point))           <span class="org-comment-delimiter">;; </span><span class="org-comment">Complete link at point
</span>
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Initialize org-roam database and sync on startup
</span>  (org-roam-db-autosync-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgddf6e23" class="outline-3">
<h3 id="orgddf6e23"><span class="section-number-3">8.2.</span> Capture Templates</h3>
<div class="outline-text-3" id="text-8-2">
<p>
Define templates for different types of notes. This follows the best practice of having different note types (fleeting, permanent, literature, etc.).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-roam
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Capture templates for different note types
</span>  (org-roam-capture-templates
   '((<span class="org-string">"d"</span> <span class="org-string">"default"</span> plain
      <span class="org-string">"%?"</span>
      <span class="org-builtin">:target</span> (file+head <span class="org-string">"%&lt;%Y%m%d%H%M%S&gt;-${slug}.org"</span>
                         <span class="org-string">"#+title: ${title}\n#+date: %U\n#+filetags: \n\n"</span>)
      <span class="org-builtin">:unnarrowed</span> t)

     (<span class="org-string">"p"</span> <span class="org-string">"permanent"</span> plain
      <span class="org-string">"* Source\n\n%?\n\n* Content\n\n\n* Links\n"</span>
      <span class="org-builtin">:target</span> (file+head <span class="org-string">"permanent/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org"</span>
                         <span class="org-string">"#+title: ${title}\n#+date: %U\n#+filetags: :permanent:\n\n"</span>)
      <span class="org-builtin">:unnarrowed</span> t)

     (<span class="org-string">"l"</span> <span class="org-string">"literature"</span> plain
      <span class="org-string">"* Source\n\nAuthor: %^{Author}\nTitle: ${title}\nYear: %^{Year}\n\n%?\n\n* Summary\n\n\n* Key Points\n\n\n* Quotes\n\n\n* Related\n"</span>
      <span class="org-builtin">:target</span> (file+head <span class="org-string">"literature/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org"</span>
                         <span class="org-string">"#+title: ${title}\n#+date: %U\n#+filetags: :literature:\n\n"</span>)
      <span class="org-builtin">:unnarrowed</span> t)

     (<span class="org-string">"c"</span> <span class="org-string">"concept"</span> plain
      <span class="org-string">"* Definition\n\n%?\n\n* Examples\n\n\n* Related Concepts\n"</span>
      <span class="org-builtin">:target</span> (file+head <span class="org-string">"concepts/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org"</span>
                         <span class="org-string">"#+title: ${title}\n#+date: %U\n#+filetags: :concept:\n\n"</span>)
      <span class="org-builtin">:unnarrowed</span> t)

     (<span class="org-string">"r"</span> <span class="org-string">"reference"</span> plain
      <span class="org-string">"* %?\n"</span>
      <span class="org-builtin">:target</span> (file+head <span class="org-string">"reference/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org"</span>
                         <span class="org-string">"#+title: ${title}\n#+date: %U\n#+filetags: :reference:\n\n"</span>)
      <span class="org-builtin">:unnarrowed</span> t))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0b04f26" class="outline-3">
<h3 id="org0b04f26"><span class="section-number-3">8.3.</span> Daily Notes Configuration</h3>
<div class="outline-text-3" id="text-8-3">
<p>
Daily notes are essential for journaling and capturing fleeting thoughts. This configuration follows best practices for daily note organization.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-roam
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Store daily notes in a dedicated subdirectory
</span>  (org-roam-dailies-directory <span class="org-string">"daily/"</span>)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Capture templates for daily notes
</span>  (org-roam-dailies-capture-templates
   '((<span class="org-string">"d"</span> <span class="org-string">"default"</span> entry
      <span class="org-string">"* %&lt;%H:%M&gt; %?"</span>
      <span class="org-builtin">:target</span> (file+head <span class="org-string">"%&lt;%Y-%m-%d&gt;.org"</span>
                         <span class="org-string">"#+title: %&lt;%Y-%m-%d (%A)&gt;\n#+filetags: :daily:\n\n"</span>))

     (<span class="org-string">"m"</span> <span class="org-string">"meeting"</span> entry
      <span class="org-string">"* %&lt;%H:%M&gt; Meeting: %^{Meeting Title}\n\n** Attendees\n%?\n\n** Notes\n\n\n** Action Items\n"</span>
      <span class="org-builtin">:target</span> (file+head <span class="org-string">"%&lt;%Y-%m-%d&gt;.org"</span>
                         <span class="org-string">"#+title: %&lt;%Y-%m-%d (%A)&gt;\n#+filetags: :daily:\n\n"</span>))

     (<span class="org-string">"j"</span> <span class="org-string">"journal"</span> entry
      <span class="org-string">"* %&lt;%H:%M&gt; Journal\n\n%?"</span>
      <span class="org-builtin">:target</span> (file+head <span class="org-string">"%&lt;%Y-%m-%d&gt;.org"</span>
                         <span class="org-string">"#+title: %&lt;%Y-%m-%d (%A)&gt;\n#+filetags: :daily:journal:\n\n"</span>))

     (<span class="org-string">"t"</span> <span class="org-string">"task"</span> entry
      <span class="org-string">"* TODO %?\n  SCHEDULED: %t\n"</span>
      <span class="org-builtin">:target</span> (file+head <span class="org-string">"%&lt;%Y-%m-%d&gt;.org"</span>
                         <span class="org-string">"#+title: %&lt;%Y-%m-%d (%A)&gt;\n#+filetags: :daily:\n\n"</span>))))

  <span class="org-builtin">:bind</span>
  ((<span class="org-string">"C-c n t"</span> . org-roam-dailies-goto-today)
   (<span class="org-string">"C-c n y"</span> . org-roam-dailies-goto-yesterday)
   (<span class="org-string">"C-c n d"</span> . org-roam-dailies-goto-date)
   (<span class="org-string">"C-c n n"</span> . org-roam-dailies-goto-next-note)
   (<span class="org-string">"C-c n p"</span> . org-roam-dailies-goto-previous-note)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf809d4c" class="outline-3">
<h3 id="orgf809d4c"><span class="section-number-3">8.4.</span> Enhanced Node Display</h3>
<div class="outline-text-3" id="text-8-4">
<p>
Customize how nodes appear in completion and searches for better usability.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-roam
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Custom function to display nodes with more context
</span>  (<span class="org-keyword">setq</span> org-roam-node-display-template
        (concat <span class="org-string">"${type:15} ${title:*} "</span> (propertize <span class="org-string">"${tags:20}"</span> 'face 'org-tag)))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Add custom properties to node display
</span>  (<span class="org-keyword">cl-defmethod</span> <span class="org-function-name">org-roam-node-type</span> ((node org-roam-node))
    <span class="org-doc">"Return the TYPE of NODE based on tags or directory."</span>
    (<span class="org-keyword">let</span> ((tags (org-roam-node-tags node))
          (file (org-roam-node-file node)))
      (<span class="org-keyword">cond</span>
       ((member <span class="org-string">"permanent"</span> tags) <span class="org-string">"&#128221; Permanent"</span>)
       ((member <span class="org-string">"literature"</span> tags) <span class="org-string">"&#128218; Literature"</span>)
       ((member <span class="org-string">"concept"</span> tags) <span class="org-string">"&#128161; Concept"</span>)
       ((member <span class="org-string">"reference"</span> tags) <span class="org-string">"&#128214; Reference"</span>)
       ((member <span class="org-string">"daily"</span> tags) <span class="org-string">"&#128197; Daily"</span>)
       ((string-match-p <span class="org-string">"/daily/"</span> file) <span class="org-string">"&#128197; Daily"</span>)
       ((string-match-p <span class="org-string">"/literature/"</span> file) <span class="org-string">"&#128218; Literature"</span>)
       ((string-match-p <span class="org-string">"/permanent/"</span> file) <span class="org-string">"&#128221; Permanent"</span>)
       ((string-match-p <span class="org-string">"/concepts/"</span> file) <span class="org-string">"&#128161; Concept"</span>)
       (t <span class="org-string">"&#128196; Note"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org63367e7" class="outline-3">
<h3 id="org63367e7"><span class="section-number-3">8.5.</span> Graph Visualization</h3>
<div class="outline-text-3" id="text-8-5">
<p>
Configure org-roam's graph visualization for better insights into your knowledge network.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> org-roam
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Graphviz executable for generating graphs
</span>  (org-roam-graph-executable (executable-find <span class="org-string">"dot"</span>))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Exclude certain tags from the graph for cleaner visualization
</span>  (org-roam-graph-exclude-matcher '(<span class="org-string">"daily"</span> <span class="org-string">"fleeting"</span>))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Use specific program for graph generation
</span>  (org-roam-graph-viewer (executable-find <span class="org-string">"open"</span>))  <span class="org-comment-delimiter">;; </span><span class="org-comment">macOS
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">For Linux: (org-roam-graph-viewer "xdg-open")
</span>  <span class="org-comment-delimiter">;; </span><span class="org-comment">For Windows: (org-roam-graph-viewer "start")
</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Additional graph settings
</span>  (org-roam-graph-extra-config
   '((<span class="org-string">"overlap"</span> . <span class="org-string">"false"</span>)
     (<span class="org-string">"splines"</span> . <span class="org-string">"true"</span>)
     (<span class="org-string">"rankdir"</span> . <span class="org-string">"LR"</span>))))  <span class="org-comment-delimiter">;; </span><span class="org-comment">Left to Right layout</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org58b5586" class="outline-3">
<h3 id="org58b5586"><span class="section-number-3">8.6.</span> UI Enhancement with org-roam-ui</h3>
<div class="outline-text-3" id="text-8-6">
<p>
Optional web-based graph visualization interface (requires separate package).
Automatically skipped on server/headless environments.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Skip org-roam-ui on server (requires browser/GUI)
</span>(<span class="org-keyword">unless</span> emacs-server-mode
  (<span class="org-keyword">use-package</span> org-roam-ui
    <span class="org-builtin">:after</span> org-roam
    <span class="org-builtin">:custom</span>
    (org-roam-ui-sync-theme t)              <span class="org-comment-delimiter">;; </span><span class="org-comment">Sync with Emacs theme
</span>    (org-roam-ui-follow t)                  <span class="org-comment-delimiter">;; </span><span class="org-comment">Follow current note in UI
</span>    (org-roam-ui-update-on-save t)          <span class="org-comment-delimiter">;; </span><span class="org-comment">Update graph on save
</span>    (org-roam-ui-open-on-start t)           <span class="org-comment-delimiter">;; </span><span class="org-comment">Open browser when activated
</span>    (org-roam-ui-browser-function #'browse-url-default-browser)  <span class="org-comment-delimiter">;; </span><span class="org-comment">Use default browser
</span>    <span class="org-builtin">:bind</span>
    (<span class="org-string">"C-c n u"</span> . org-roam-ui-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9551282" class="outline-3">
<h3 id="org9551282"><span class="section-number-3">8.7.</span> Performance Optimizations</h3>
<div class="outline-text-3" id="text-8-7">
<p>
Best practices for maintaining good performance with large note collections.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">  (<span class="org-keyword">use-package</span> org-roam
    <span class="org-builtin">:custom</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Increase cache size for better performance
</span>    (org-roam-db-gc-threshold most-positive-fixnum)

    <span class="org-comment-delimiter">;; </span><span class="org-comment">Update database asynchronously
</span>    (org-roam-db-update-method 'immediate)

    <span class="org-builtin">:config</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Auto-save database periodically
</span>    (run-with-idle-timer 300 t #'org-roam-db-sync))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Helper function for safe note deletion
</span>  (<span class="org-keyword">defun</span> <span class="org-function-name">fu/org-roam-node-delete</span> (<span class="org-type">&amp;optional</span> node)
    <span class="org-doc">"Delete an org-roam NODE after showing backlinks warning.
If NODE is not provided, prompt to select a note from minibuffer.
If called from within a note, can use current note."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">let*</span> ((node (<span class="org-keyword">or</span> node
                     (<span class="org-keyword">if</span> (derived-mode-p 'org-mode)
                         <span class="org-comment-delimiter">;; </span><span class="org-comment">Try current node first, fall back to selection
</span>                         (<span class="org-keyword">or</span> (org-roam-node-at-point)
                             (org-roam-node-read))
                       <span class="org-comment-delimiter">;; </span><span class="org-comment">Not in org-mode, always prompt
</span>                       (org-roam-node-read))))
           (file (org-roam-node-file node))
           (title (org-roam-node-title node))
           (backlinks (org-roam-backlinks-get node))
           (buffer (find-buffer-visiting file)))
      (<span class="org-keyword">if</span> backlinks
          (<span class="org-keyword">progn</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">Open the file if not already open
</span>            (<span class="org-keyword">unless</span> buffer
              (find-file file))
            (org-roam-buffer-toggle)
            (message <span class="org-string">"WARNING: %d notes link to '</span><span class="org-string"><span class="org-constant">%s</span></span><span class="org-string">'! Check backlinks first."</span>
                     (length backlinks) title))
        (<span class="org-keyword">when</span> (yes-or-no-p (format <span class="org-string">"Delete '</span><span class="org-string"><span class="org-constant">%s</span></span><span class="org-string">'? "</span> title))
          (<span class="org-keyword">when</span> buffer (kill-buffer buffer))
          (delete-file file)
          (org-roam-db-sync)
          (message <span class="org-string">"Note '</span><span class="org-string"><span class="org-constant">%s</span></span><span class="org-string">' deleted and database synced."</span> title)))))

  (<span class="org-keyword">provide</span> '<span class="org-constant">org-conf</span>)
  <span class="org-comment-delimiter">;;; </span><span class="org-comment">org-conf.el ends here</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org91b7646" class="outline-3">
<h3 id="org91b7646"><span class="section-number-3">8.8.</span> Best Practices Summary</h3>
<div class="outline-text-3" id="text-8-8">
<p>
Key principles to follow when using org-roam:
</p>

<ol class="org-ol">
<li><b>Atomic Notes</b>: One idea per note - keeps notes focused and linkable</li>
<li><b>Consistent Tagging</b>: Use tags systematically (e.g., <code>:permanent:</code>, <code>:literature:</code>, <code>:concept:</code>)</li>
<li><b>Regular Capturing</b>: Use daily notes to capture fleeting thoughts immediately</li>
<li><b>Link Liberally</b>: Create connections between notes to build your knowledge graph</li>
<li><b>Regular Reviews</b>: Periodically review and refactor notes to strengthen connections</li>
<li><b>Structured Templates</b>: Use capture templates to maintain consistency</li>
<li><b>Hierarchical Organization</b>: Use subdirectories (daily/, literature/, etc.) for better organization</li>
<li><b>Database Maintenance</b>: Let org-roam-db-autosync-mode handle synchronization automatically</li>
<li><b>Safe Deletion</b>: Always check backlinks before deleting notes to avoid orphaned links</li>
</ol>
</div>
</div>

<div id="outline-container-org5220ae1" class="outline-3">
<h3 id="org5220ae1"><span class="section-number-3">8.9.</span> Common Workflows</h3>
<div class="outline-text-3" id="text-8-9">
</div>
<div id="outline-container-orgd954c42" class="outline-4">
<h4 id="orgd954c42"><span class="section-number-4">8.9.1.</span> Creating a New Note</h4>
<div class="outline-text-4" id="text-8-9-1">
<ol class="org-ol">
<li><code>C-c n f</code> (org-roam-node-find)</li>
<li>Type the note title</li>
<li>Select template (or use default)</li>
<li>Write your note with <code>[[links]]</code> to other notes</li>
</ol>
</div>
</div>

<div id="outline-container-org183e535" class="outline-4">
<h4 id="org183e535"><span class="section-number-4">8.9.2.</span> Linking Notes</h4>
<div class="outline-text-4" id="text-8-9-2">
<ol class="org-ol">
<li><code>C-c n i</code> (org-roam-node-insert) while writing</li>
<li>Search for existing note or create new one</li>
<li>Link is created bidirectionally</li>
</ol>
</div>
</div>

<div id="outline-container-orge2d1330" class="outline-4">
<h4 id="orge2d1330"><span class="section-number-4">8.9.3.</span> Daily Journaling</h4>
<div class="outline-text-4" id="text-8-9-3">
<ol class="org-ol">
<li><code>C-c n j</code> (org-roam-dailies-capture-today)</li>
<li>Select template (journal, meeting, task, etc.)</li>
<li>Write entry - automatically timestamped</li>
</ol>
</div>
</div>

<div id="outline-container-orgd9945ff" class="outline-4">
<h4 id="orgd9945ff"><span class="section-number-4">8.9.4.</span> Reviewing Connections</h4>
<div class="outline-text-4" id="text-8-9-4">
<ol class="org-ol">
<li><code>C-c n l</code> (org-roam-buffer-toggle) to see backlinks</li>
<li><code>C-c n g</code> (org-roam-graph) for visual exploration</li>
<li><code>C-c n u</code> (org-roam-ui-mode) for interactive web interface</li>
</ol>
</div>
</div>

<div id="outline-container-org3a6de26" class="outline-4">
<h4 id="org3a6de26"><span class="section-number-4">8.9.5.</span> Deleting Notes Safely</h4>
<div class="outline-text-4" id="text-8-9-5">
<p>
<b>Method 1: Delete from anywhere (recommended)</b>
</p>
<ol class="org-ol">
<li><code>M-x fu/org-roam-node-delete</code> from any buffer</li>
<li>Select the note to delete from minibuffer (with completion)</li>
<li>If backlinks exist, the note opens and backlinks sidebar shows warning</li>
<li>Check each linking note and update/remove links</li>
<li>Run the command again to confirm deletion</li>
<li>Database automatically syncs after deletion</li>
</ol>

<p>
<b>Method 2: Delete current note</b>
</p>
<ol class="org-ol">
<li>Open the note you want to delete</li>
<li><code>M-x fu/org-roam-node-delete</code> (automatically uses current note)</li>
<li>Follow steps 3-6 from Method 1</li>
</ol>

<p>
<b>Alternative manual method:</b>
</p>
<ol class="org-ol">
<li><code>C-c n l</code> to check backlinks first</li>
<li>Update all linking notes</li>
<li>Delete the file normally</li>
<li><code>M-x org-roam-db-sync</code> to clean up the database</li>
</ol>
</div>
</div>
</div>
</div>

<div id="outline-container-org978c848" class="outline-2">
<h2 id="org978c848"><span class="section-number-2">9.</span> End of File</h2>
<div class="outline-text-2" id="text-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">provide</span> '<span class="org-constant">doc-org-conf</span>)
<span class="org-comment-delimiter">;;; </span><span class="org-comment">doc-org-conf.el ends here</span>
</pre>
</div>
</div>
</div>
</main>
</body>
</html>
